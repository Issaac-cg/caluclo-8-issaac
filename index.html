<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Funciones con Canvas</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@12.4.1/lib/browser/math.min.js"></script>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #f0f0f8;
      color: #222;
      padding: 25px;
      max-width: 700px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #4a4a8a;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #333366;
    }
    input[type=text], input[type=number] {
      width: 100%;
      padding: 8px;
      font-size: 1.1em;
      border: 2px solid #8888cc;
      border-radius: 5px;
      box-sizing: border-box;
      margin-top: 5px;
    }
    button {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      font-size: 1.2em;
      background-color: #5555aa;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #333377;
    }
    #canvasContainer {
      margin-top: 30px;
      text-align: center;
    }
    canvas {
      border: 2px solid #444477;
      background-color: #fff;
      border-radius: 10px;
    }
    #info {
      margin-top: 20px;
      font-size: 1.1em;
      color: #222244;
      text-align: center;
      font-weight: bold;
    }
    #error {
      color: darkred;
      font-weight: bold;
      margin-top: 15px;
      text-align: center;
    }
  </style>
</head>
<body>

<h1>Calculadora de Funciones y Gráfica</h1>

<label for="funcion">Introduce la función f(x):</label>
<input type="text" id="funcion" placeholder="Ejemplo: sin(x) + x^2" value="sin(x) + x^2">

<label for="xmin">Dominio desde (mínimo x):</label>
<input type="number" id="xmin" value="-10" step="any">

<label for="xmax">Dominio hasta (máximo x):</label>
<input type="number" id="xmax" value="10" step="any">

<button id="btnGraficar">Calcular y Graficar</button>

<div id="error"></div>
<div id="info"></div>

<div id="canvasContainer">
  <canvas id="grafica" width="650" height="400"></canvas>
</div>

<script>
  const canvas = document.getElementById('grafica');
  const ctx = canvas.getContext('2d');
  const info = document.getElementById('info');
  const errorDiv = document.getElementById('error');
  const btn = document.getElementById('btnGraficar');

  function limpiarCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function dibujarEjes(xmin, xmax, ymin, ymax) {
    ctx.strokeStyle = '#444477';
    ctx.lineWidth = 1;
    ctx.font = '12px monospace';
    ctx.fillStyle = '#444477';

    // Eje X
    const y0 = mapY(0, ymin, ymax);
    ctx.beginPath();
    ctx.moveTo(0, y0);
    ctx.lineTo(canvas.width, y0);
    ctx.stroke();

    // Eje Y
    const x0 = mapX(0, xmin, xmax);
    ctx.beginPath();
    ctx.moveTo(x0, 0);
    ctx.lineTo(x0, canvas.height);
    ctx.stroke();

    // Marcas en eje X
    const xRange = xmax - xmin;
    const xStep = calcularPaso(xRange);
    for(let x = Math.ceil(xmin/xStep)*xStep; x <= xmax; x += xStep) {
      const px = mapX(x, xmin, xmax);
      ctx.beginPath();
      ctx.moveTo(px, y0 - 5);
      ctx.lineTo(px, y0 + 5);
      ctx.stroke();
      ctx.fillText(x.toFixed(2), px - 10, y0 + 18);
    }

    // Marcas en eje Y
    const yRange = ymax - ymin;
    const yStep = calcularPaso(yRange);
    for(let y = Math.ceil(ymin/yStep)*yStep; y <= ymax; y += yStep) {
      const py = mapY(y, ymin, ymax);
      ctx.beginPath();
      ctx.moveTo(x0 - 5, py);
      ctx.lineTo(x0 + 5, py);
      ctx.stroke();
      if (Math.abs(y) > 1e-6) ctx.fillText(y.toFixed(2), x0 + 8, py + 4);
    }
  }

  function calcularPaso(rango) {
    // Escoge un paso "bonito" para las marcas del eje
    const base = Math.pow(10, Math.floor(Math.log10(rango)) - 1);
    if (rango / base < 5) return base / 2;
    return base;
  }

  function
