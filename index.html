<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Dominio, Rango y Gráfica de Funciones</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label { display: block; margin-top: 10px; }
  input, button { padding: 5px; font-size: 1em; }
  #graph { width: 600px; height: 400px; margin-top: 20px; }
</style>
</head>
<body>

<h2>Calcula dominio, rango y grafica una función</h2>

<form id="funcForm">
  <label>Función f(x) (ejemplo: x*x, Math.sin(x), x**3 - 2*x):</label>
  <input type="text" id="funcInput" size="40" value="x*x" required />
  
  <label>Intervalo de x (mínimo):</label>
  <input type="number" id="xMin" value="-10" required />
  
  <label>Intervalo de x (máximo):</label>
  <input type="number" id="xMax" value="10" required />
  
  <button type="submit">Calcular y Graficar</button>
</form>

<div id="result"></div>
<div id="graph"></div>

<script>
document.getElementById('funcForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const funcStr = document.getElementById('funcInput').value;
  const xMin = parseFloat(document.getElementById('xMin').value);
  const xMax = parseFloat(document.getElementById('xMax').value);

  // Validar intervalo
  if (xMax <= xMin) {
    alert('El valor máximo debe ser mayor que el mínimo.');
    return;
  }

  // Crear función segura usando Function constructor
  // Solo se permite usar "x" y Math para evitar riesgos
  let f;
  try {
    f = new Function('x', 'with(Math){ return ' + funcStr + '; }');
    // Probar función con un valor
    f(0);
  } catch (error) {
    alert('Función inválida. Usa sintaxis JavaScript válida, por ejemplo: x*x, Math.sin(x), x**3 - 2*x');
    return;
  }

  // Generar datos para graficar y calcular rango
  const n = 500; // puntos para graficar
  const step = (xMax - xMin) / n;
  let xValues = [];
  let yValues = [];

  for (let i = 0; i <= n; i++) {
    let x = xMin + i * step;
    let y;
    try {
      y = f(x);
      if (typeof y !== 'number' || !isFinite(y)) y = NaN;
    } catch {
      y = NaN;
    }
    xValues.push(x);
    yValues.push(y);
  }

  // Filtrar valores válidos para rango
  const yValid = yValues.filter(y => !isNaN(y));
  const yMin = Math.min(...yValid);
  const yMax = Math.max(...yValid);

  // Mostrar dominio y rango
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = `<p><strong>Dominio:</strong> [${xMin}, ${xMax}]</p>
                         <p><strong>Rango aproximado:</strong> [${yMin.toFixed(3)}, ${yMax.toFixed(3)}]</p>`;

  // Graficar con Plotly
  const trace = {
    x: xValues,
    y: yValues,
    mode: 'lines',
    name: 'f(x)'
  };

  const layout = {
    title: 'Gráfica de f(x)',
    xaxis: { title: 'x' },
    yaxis: { title: 'f(x)' },
    showlegend: true
  };

  Plotly.newPlot('graph', [trace], layout);
});
</script>

</body>
</html>
